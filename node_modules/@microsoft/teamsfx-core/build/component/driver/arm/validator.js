"use strict";
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.
Object.defineProperty(exports, "__esModule", { value: true });
exports.validateArgs = void 0;
const uuid_1 = require("uuid");
const bicepChecker_1 = require("../../utils/depsChecker/bicepChecker");
const constant_1 = require("./constant");
const util_1 = require("./util/util");
async function validateArgs(args) {
    const invalidParameters = [];
    if (!args.subscriptionId || !uuid_1.validate(args.subscriptionId)) {
        invalidParameters.push("subscriptionId is invalid");
    }
    if (!args.resourceGroupName) {
        invalidParameters.push("resourceGroupName is invalid");
    }
    const res = await validateTemplates(args.templates);
    invalidParameters.push(...res);
    const needBicepCli = util_1.hasBicepTemplate(args.templates);
    if (!(await validateBicep(args.bicepCliVersion, needBicepCli))) {
        invalidParameters.push("bicepCliVersion is invalid");
    }
    return invalidParameters;
}
exports.validateArgs = validateArgs;
async function validateBicep(bicepCliVersion, needBicepCli) {
    if (!needBicepCli) {
        return true;
    }
    if (bicepCliVersion) {
        const versions = await bicepChecker_1.getAvailableBicepVersions();
        return versions.includes(bicepCliVersion);
    }
    return true;
}
function validateTemplates(templates) {
    const res = [];
    if (templates.length === 0) {
        res.push(`templates is invalid for it is empty`);
    }
    for (let i = 0; i < templates.length; i++) {
        const iRes = validateTemplate(templates[i]);
        for (const value of iRes) {
            res.push(`templates.${i}.${value}`);
        }
    }
    return res;
}
function validateTemplate(template) {
    const res = [];
    if (!template.deploymentName) {
        res.push("deploymentName is invalid");
    }
    if (template.parameters && util_1.getFileExtension(template.parameters) !== "json") {
        res.push("parameters is invalid");
    }
    const templateType = util_1.getFileExtension(template.path);
    if (templateType !== constant_1.TemplateType.Json && templateType !== constant_1.TemplateType.Bicep) {
        res.push("path is invalid");
    }
    return res;
}
//# sourceMappingURL=validator.js.map